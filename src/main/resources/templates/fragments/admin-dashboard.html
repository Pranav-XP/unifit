<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/common :: commonHead(~{::title})}">
    <title>UniFit | Admin</title>
</head>
<body class="bg-gray-100">
<div th:replace="fragments/admin-header :: header"></div>
<div th:replace="fragments/sidebar :: aside"></div>

<!--/* Dynamic main content area where any fragment can be inserted */-->
<main class="lg:ml-[16.667%] p-6">
    <section th:insert="~{::content}"></section>
</main>
<script>
    const socket = new SockJS("/ws");
    const stompClient = Stomp.over(socket);

    stompClient.connect({}, () => {
        stompClient.subscribe("/topic/admin", (notification) => {
            // Handle the incoming notification
            const message = JSON.parse(notification.body);
            console.log("Recieved Booking Notification:", message);
            // Display the notification to the admin
            displayNotification(message);
        });
    });

    function displayNotification(notification) {
        // Extract booking information
        let bookingId = notification.bookingId;
        let customerName = notification.customerName;
        let facilityName = notification.facilityName;

        // Create a message for the toast
        var message = `${customerName} has made a booking at ${facilityName}.`;

        // Show a toast notification
        Toastify({
            text: message,
            duration: 5000, // Adjust duration as needed
            close: true,
            gravity: "top", // Position of the toast
            position: "right", // Position of the toast
            className: "font-semibold bg-blue-500 hover:bg-blue-600",
            destination: `/admin/booking/${bookingId}`,
        }).showToast();
    }
</script>
</body>
<script
        type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/toastify-js"
></script>
</html>